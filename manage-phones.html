<html>
<head>
    <script type="text/javascript" src="jobmanapi.js"></script>
    <title>Jobman Phone Management Page</title>
    <script>var userName = getQueryParameter('userName');
        var primaryPhoneNumberId = getQueryParameter('primaryId');
        var sessionId = getQueryParameter('sessionId');
        var phoneCount = 0;

        function onSuccess(data) {
            phoneCount = 0;
            document.getElementById('ctry-code').value = "";
            document.getElementById('number').value = "";
            document.getElementById('features').value = "";
            document.getElementById('type').value = ""; 
            document.getElementById('phoneNumberList').innerHTML = "";

            data.forEach(appendPhoneNumber);


        }

        function removePhoneNumber(id) {
            deleteUserPhoneNumber(id,
                init,
                onError);
        }

        function makePhoneNumberPrimary(id) {
            setUserPrimaryPhoneNumber(id,
                function () {
                    primaryPhoneNumberId = id;
                    init();
                },
                onError);
        }

        function appendPhoneNumber(phoneNumber) {
            phoneCount++;
            var isPrimary = phoneNumber.phoneNumberId == primaryPhoneNumberId;
            var listDiv = document.getElementById('phoneNumberList');
            listDiv.innerHTML += '<p><strong>PHONE NUMBER ' + phoneCount;
            if (isPrimary) {
                listDiv.innerHTML += '(Primary Phone Number)';
            }
            listDiv.innerHTML += '</strong ></p>';
            listDiv.innerHTML += '<label> + ' + phoneNumber.countryCode + ' ' + phoneNumber.numberText + '</label><br/>';
            if (!isStringAndEmpty(phoneNumber.features)) {
                listDiv.innerHTML += '<label>Features : ' + phoneNumber.features + '</label><br/>';
            }
            if (!isStringAndEmpty(phoneNumber.type)) {
                listDiv.innerHTML += '<label>Type : ' + phoneNumber.type + '</label><br/>';
            }
            if (!isPrimary) {
                listDiv.innerHTML += '<button  onclick="removePhoneNumber(\'' + phoneNumber.phoneNumberId + '\')">Remove</button>&nbsp;&nbsp;<button  onclick="makePhoneNumberPrimary(\'' + phoneNumber.phoneNumberId + '\')">Set As Primary</button><br /><br/>';
            }
        }



        function onError(details) {

        }

        function goBackToUserProfile() {
            document.location.href = getPathPrefix(document.location.href) + '/landingpage.html?sessionId=' + sessionId;
        }

        function init() {
            document.getElementById('userName').textContent = userName;
            getUserPhoneNumbers(onSuccess, onError)
        }

        window.addEventListener('load', init);</script>
</head>
<body>
    <button onclick="goBackToUserProfile()">Go back To User Profile</button><br /><br />
    <form id="theForm">
        <p><strong>MANAGE PHONES NUMBERS </strong> for <span id="userName"></span></p><br />
        <label><strong>Add Phone Number:&nbsp;</strong></label><br /><br />
        <label>&nbsp;&nbsp;&nbsp;Country Code:&nbsp;</label><input id="ctry-code" type="text" /><br /><br />
        <label>&nbsp;&nbsp;&nbsp;Phone Number:&nbsp;</label><input id="number" type="text" /><br /><br />
        <label>&nbsp;&nbsp;&nbsp;Phone Features:&nbsp;</label><input id="features" type="text" /><br /><br />
        <label>&nbsp;&nbsp;&nbsp;Phone Type:&nbsp;</label><input id="type" type="text" /><br /><br />
        <button type="submit">Add</button><br />
    </form>
    <br /><br />
    <div id="phoneNumberList">

    </div>
    <script>document.getElementById('theForm').onsubmit = function () {
            var phoneNumber =
            {
                countryCode : document.getElementById('ctry-code').value,
                numberText : document.getElementById('number').value,
                features: document.getElementById('features').value,
                type : document.getElementById('type').value 
            };
    addUserPhoneNumber(
        phoneNumber,
                init,
                onError);
            return false;
        };</script>

</body>
</html>